{% extends 'base.html' %}

{% block content %}
<div class="chat-container">
    <h2>Create or Join a Chat ðŸ˜¼</h2>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const toggleBtn = document.getElementById("toggle-more");
            const moreRooms = document.getElementById("more-rooms");

            if (toggleBtn) {
                toggleBtn.addEventListener("click", function () {
                    moreRooms.classList.toggle("hidden");
                    toggleBtn.textContent = moreRooms.classList.contains("hidden") ? "More Rooms âž•" : "Less âž–";
                });
            }
        });
    </script>


    <!-- Formulaire pour crÃ©er ou entrer une room -->
    <form id="post-form-home" method="POST" action="{% url 'checkview' %}">
        {% csrf_token %}
        <fieldset class="room-details">
            <legend>Enter Room and Username</legend>

            <div class="form-group">
                <label for="room_name">Room Name:</label>
                <input type="text" name="room_name" id="room_name" placeholder="Enter room name" required />
            </div>

            <div class="form-group">
                <label for="username">Username :</label>
                <input type="text" name="username" id="username" placeholder="Enter your username" required />
            </div>

            <div class="form-group">
                <input type="submit" value="Enter Room" class="btn-submit">
            </div>
        </fieldset>
    </form>

    <div class="existing-rooms">
        {% if rooms %}
        <h3>{{ rooms|length }} Rooms Open ðŸŸ¢</h3>
        <p>First 5 rooms:</p>

        <!-- Les 5 premiÃ¨res rooms -->
        <div class="room-cards">
            {% for room in rooms|slice:":5" %}
            <div class="room-card">
                <h4>{{ room.name }}</h4>
                <p>Join this chat room now ðŸš€</p>
                <form method="POST" action="{% url 'checkview' %}">
                    {% csrf_token %}
                    <input type="hidden" name="room_name" value="{{ room.name }}">
                    <input type="text" name="username" placeholder="Enter your username" required>
                    <button type="submit" class="btn-join">Enter</button>
                </form>
            </div>
            {% endfor %}
        </div>

        <!-- Les autres rooms si plus de 5 -->
        {% if rooms|length > 5 %}
        <button id="toggle-more" class="btn-more">More Rooms</button>
        <div class="room-cards hidden" id="more-rooms">
            {% for room in rooms|slice:"5:" %}
            <div class="room-card">
                <h4>{{ room.name }}</h4>
                <p>Join this chat room now ðŸš€</p>
                <form method="POST" action="{% url 'checkview' %}">
                    {% csrf_token %}
                    <input type="hidden" name="room_name" value="{{ room.name }}">
                    <input type="text" name="username" placeholder="Enter your username" required>
                    <button type="submit" class="btn-join">Enter</button>
                </form>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% else %}
        <p>No rooms yet ðŸ˜¿</p>
        {% endif %}
    </div>
</div>
{% endblock %}